#!/usr/bin/env php
<?php

require_once __DIR__ . '/../bootstrap.php';

use Hoa\Console;
use Hoa\Dispatcher;
use Hoa\Router;

/**
 * Entry point of the CLI script.
 *
 * @copyright Copyright (C) 2007-2015 fruux GmbH (https://fruux.com/).
 * @author Ivan Enderlin
 * @license http://sabre.io/license/ Modified BSD License
 */

try {

    $router = new Router\Cli();
    $router
        ->get(
            'global',
            '(?<command>\w+)?(?<_tail>.*?)',
            'main',
            'main',
            ['command' => 'welcome']
        );

    $dispatcher = new Dispatcher\ClassMethod([
        'synchronous.call' => 'Sabre\Katana\Bin\(:%variables.command:lU:)',
        'synchronous.able' => 'main'
    ]);
    $dispatcher->setKitName('Hoa\Console\Dispatcher\Kit');

    exit((int) $dispatcher->dispatch($router));

} catch (\Exception $e) {

    ob_start();
    Console\Cursor::colorize('foreground(white) background(red)');
    echo $e->getMessage(), "\n";
    Console\Cursor::colorize('normal');
    $content = ob_get_contents();
    ob_end_clean();

    file_put_contents('php://stderr', $content);

    exit(1);

}
